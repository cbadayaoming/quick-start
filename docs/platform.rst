.. platform .

---------
平台管理
---------

Nano提供了一系列便捷的管理功能，用于简化管理员的日常运维工作。

仪表盘
===========

Nano门户首页提供了整个平台级别的资源用量仪表盘，包含虚拟资源和物理资源的用量，便于随时了解系统负载情况，及时对资源进行扩充或者调整。

.. image:: images/4_dashboard.png

管理员可以点击仪表盘，下钻查看资源池、Cell节点或者云主机实例的实时用量

.. image:: images/4_instances.png

增加资源节点
=============

当系统负载较大时，可以通过添加新的资源节点，来扩充池内可用资源。

首先需要在新的服务器上部署并启动Cell模块，然后在资源池的节点清单中，选择"Add Cell"

.. image:: images/4_add_cell.png

在下来菜单中选择新装的Cell节点进行添加

.. image:: images/4_select_cell.png

当资源池中Cell节点状态变为Online时，就可以承载新建的云主机实例了。

.. image:: images/4_new_cell_status.png


构建模板镜像
=============

Nano可以将任意云主机的系统磁盘制作成磁盘镜像，然后从镜像快速克隆出与原模板主机系统、软件一样的新实例，以便大幅度提升管理员部署实例的效率。

.. image:: images/4_image_transport.png

要构建模板镜像，首先应该创建一个不含数据磁盘的空白云主机，然后通过加载系统光盘和网络方式安装好系统和软件。

以CentOS7为例，构建模板主机时，建议进行如下设置：

- 设置模板主机名和默认用户密码
- 默认启用网络并设置为DHCP获取地址
- 安装acpid服务支持关机和重启操作
- 安装qemu-guest-agent以支持实时密码修改、内存用量监控等功能
- 使用yum更新软件版本
- 如果需要使用Nano的Cloud Init服务对实例进行自动初始化设置，则需要安装cloud-init/cloud-utils组件

上述设置完成后，关闭云主机，通过"Images" => "BUILD"，进入镜像构建界面，在下拉菜单中选择模板云主机，点击创建

.. image:: images/4_build_image.png


当镜像制作完毕后，你就可以在新建云主机时选择从该镜像克隆实例了。

版本升级
===========

Nano所有模块使用go编译为二进制可执行文件，无需外部库依赖，配置和数据文件格式通常保持后向兼容，无需用户干预。

所以当版本升级时，只需要使用"./模块名 stop"停止运行中的模块文件，替换可执行文件后使用"./模块名 start"重新启动服务即可。

唯一例外是FrontEnd模块还包含前端页面文件，所以升级时，除了要替换可执行文件，还需要手工将页面和js脚本文件从发布包中复制resource目录下进行覆盖。

网络变更
===========

Core与FrontEnd使用指定地址为用户提供服务，所以当所在服务器IP发生变化时，需要修改config目录下的配置IP，然后重启模块完成变更。

Cell模块通过组播协议和Core模块自动发现所在服务器地址并完成组网，所以当Cell服务器IP变化时，只需要重新启动Cell模块，后续地址变更、组网和实例网络调整由可以由系统自动完成，无需网络干预。

当整个平台整体迁移或者变更到完全不同的网络时，请首先调整Core模块的监听IP和组播信息，确保Core模块正常启动后，再启动Cell模块，完成新网络识别和自动切换即可。

故障迁移
==========

当计算资源池使用共享存储作为后端存储时，可以开启故障迁移(Failover)开关。功能开启后，如果Nano平台检测到某一Cell节点失联，会自动将该节点管理的云主机实例迁移到集群内的一个或者多个Cell节点上。

.. image:: images/4_enable_failover.png

如果原实例设置了自动启动，则迁移完成后，系统会自动将实例启动进入服务状态。

**如果失联Cell节点恢复并重新加入Nano集群，系统将自动清除该Cell上的所有实例，并将该Cell置于禁用状态，管理员需要手动重新启用节点。**

禁用节点
==========

默认情况下，Nano会在资源池中选择负载较低的活动Cell节点创建云主机实例，但是用户可以选择手动禁用Cell节点，来避免在该节点上分配新的云主机实例，便于进行维护或者控制节点负载。

.. image:: images/4_disable_cell.png

禁用的节点上云主机依然正常运行和管理，不受影响。禁用节点可以稍后手动重新启用，恢复承接新实例。

多语言
========

Nano管理页面目前支持中文、英文两种语言，可以在界面开关切换，Nano会记住用户选项，只需选择一次，不用反复设置。
